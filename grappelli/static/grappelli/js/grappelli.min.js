var grp={jQuery:jQuery.noConflict(!0)},django={jQuery:grp.jQuery.noConflict(!0)},inputTypes=["[type='search']","[type='email']","[type='url']","[type='tel']","[type='number']","[type='range']","[type='date']","[type='month']","[type='week']","[type='time']","[type='datetime']","[type='datetime-local']","[type='color']"].join(",");!function(e){grappelli.getFormat=function(e){if("date"==e){var t=DATE_FORMAT.toLowerCase().replace(/%\w/g,function(e){return e=e.replace(/%/,""),e+e});return t}},grappelli.cleanInputTypes=function(){e("form").each(function(){e(this).find(":input").filter(inputTypes).each(function(){e(this).attr("type","text")})})},grappelli.initDateAndTimePicker=function(){e("p.datetime").each(function(){var t=e(this).html();t=t.replace(/^\w*: /,""),t=t.replace(/<br>[^<]*: /g,"<br>"),e(this).html(t)});var t={constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date"),showButtonPanel:!0,showAnim:"",beforeShow:function(e,t,r){grappelli.datepicker_instance=this}},r=e("input[class*='vDateField']:not([id*='__prefix__'])");r.datepicker(t),"undefined"!=typeof IS_POPUP&&IS_POPUP&&r.datepicker("disable"),e(document).on("click",".ui-datepicker-current",function(){e.datepicker._selectDate(grappelli.datepicker_instance),grappelli.datepicker_instance=null}),e("input[class*='vTimeField']:not([id*='__prefix__'])").grp_timepicker()},grappelli.initFilter=function(){e("a.grp-pulldown-handler").click(function(){var t=e(this).closest(".grp-pulldown-container");e(t).toggleClass("grp-pulldown-state-open").children(".grp-pulldown-content").toggle()}),e("a.grp-pulldown-handler").bind("mouseout",function(){e(this).blur()}),e(".grp-filter-choice").change(function(){location.href=e(this).val()})},grappelli.initSearchbar=function(){var t=e("input.grp-search-field");t.focus()},grappelli.updateSelectFilter=function(e){"undefined"!=typeof SelectFilter&&(e.find(".selectfilter").each(function(e,t){var r=t.name.split("-");SelectFilter.init(t.id,r[r.length-1],!1,"{% admin_media_prefix %}")}),e.find(".selectfilterstacked").each(function(e,t){var r=t.name.split("-");SelectFilter.init(t.id,r[r.length-1],!0,"{% admin_media_prefix %}")}))},grappelli.reinitDateTimeFields=function(e){e.find(".vDateField").datepicker({constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date")}),e.find(".vTimeField").grp_timepicker()},grappelli.get_app_label=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("?")[0].split("/");return r[r.length-3]}return!1},grappelli.get_model_name=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("?")[0].split("/");return r[r.length-2]}return!1},grappelli.get_query_string=function(e){var t=e.next("a");if(t.length>0){var r=t.attr("href").split("/");return pairs=r[r.length-1].replace("?","").split("&"),pairs.join(":")}return!1}}(grp.jQuery),function(e){e.fn.grp_collapsible=function(r){var n={toggle_handler_slctr:".grp-collapse-handler:first",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_toggle:function(){}},a=e.extend(n,r);return this.each(function(){t(e(this),a)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){n(e,t)},n=function(e,t){e.children(t.toggle_handler_slctr).click(function(){e.toggleClass(t.closed_css).toggleClass(t.open_css),t.on_toggle(e,t)})}}(grp.jQuery),function(e){e.fn.grp_collapsible_group=function(r){var n={open_handler_slctr:".grp-open-handler",close_handler_slctr:".grp-close-handler",collapsible_container_slctr:".grp-collapse",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_open:function(){},on_close:function(){}};return r=e.extend(n,r),this.each(function(){t(e(this),r)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){n(e,t),a(e,t)},n=function(t,r){t.find(r.open_handler_slctr).each(function(){e(this).click(function(){r.on_open(t,r),t.find(r.collapsible_container_slctr).removeClass(r.closed_css).addClass(r.open_css),t.removeClass(r.closed_css).addClass(r.open_css)})})},a=function(t,r){t.find(r.close_handler_slctr).each(function(){e(this).click(function(){r.on_close(t,r),t.find(r.collapsible_container_slctr).removeClass(r.open_css).addClass(r.closed_css)})})}}(grp.jQuery),function(e){e.widget("ui.grp_timepicker",{options:{template:'<div id="ui-timepicker" class="module" style="position: absolute; display: none;"></div>',timepicker_selector:"#ui-timepicker",offset:{top:0},default_time_list:["now","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],time_list:[]},_create:function(){var t=this;e(document).mousedown(function(r){if(t.timepicker.is(":visible")){var n=e(r.target);n[0].id==t.timepicker[0].id||0!==n.parents(t.options.timepicker_selector).length||n.hasClass("hasTimepicker")||n.hasClass("ui-timepicker-trigger")||t.timepicker.hide()}}),e(document).keyup(function(e){27==e.keyCode&&t.timepicker.hide()}),0===e(this.options.timepicker_selector).size()&&e(this.options.template).appendTo("body"),this.timepicker=e(this.options.timepicker_selector),this.timepicker.hide(),this.element.addClass("hasTimepicker"),this.button=e('<button type="button" class="ui-timepicker-trigger"></button>'),this.element.after(this.button),this.element.prop("disabled")?this.button.prop("disabled",!0):this.button.click(function(){t._toggleTimepicker()})},_toggleTimepicker:function(){this.timepicker.is(":visible")?this.timepicker.hide():(this.element.focus(),this._generateTimepickerContents(),this._showTimepicker())},_generateTimepickerContents:function(){var t=this,r="<ul>";0===this.options.time_list.length&&(this.options.time_list=this.options.default_time_list);for(var n=0;n<this.options.time_list.length;n++)if("now"==this.options.time_list[n]){var a=new Date,i=a.getHours(),l=a.getMinutes();i=10>i?"0"+i:i,l=10>l?"0"+l:l,r+='<li class="ui-state-active row">'+i+":"+l+"</li>"}else r+='<li class="ui-state-default row">'+this.options.time_list[n]+"</li>";r+="</ul>",this.timepicker.html(r),this.timepicker.find("li").click(function(){e(this).parent().children("li").removeClass("ui-state-active"),e(this).addClass("ui-state-active"),t.element.val(e(this).html()),t.timepicker.hide()})},_showTimepicker:function(){var e=document.documentElement.clientHeight,t=document.documentElement.scrollTop||document.body.scrollTop,r=this.element.outerHeight(),n=this.timepicker.outerHeight()+r,a=this.element.offset().top,i=this.element.offset().left,l=a-t+n+60;if(e>l){var o=a+r;this.timepicker.css("left",i+"px").css("top",o+"px")}else{var p=a-n+r;this.timepicker.css("left",i+"px").css("top",p+"px")}this.timepicker.show()},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments)}})}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_fk.defaults,t),this.each(function(){var n=e(this),a=n.parent();a.find("a.related-lookup").next().is("strong")&&(a.find("a.related-lookup").get(0).nextSibling.nodeValue="",a.find("a.related-lookup").next("strong").remove()),a.find("a.related-lookup").after(t.placeholder),n.addClass("grp-has-related-lookup"),r(n,t),n.bind("change focus keyup",function(){r(n,t)})})}};e.fn.grp_related_fk=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_fk"),!1):t.init.apply(this,arguments)};var r=function(t,r){var n=t.parent().find(".grp-placeholder-related-fk");e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(e){""===e[0].label?n.hide():n.show(),n.html('<span class="grp-placeholder-label">'+e[0].label+"</span>")})};e.fn.grp_related_fk.defaults={placeholder:'<div class="grp-placeholder-related-fk"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_m2m.defaults,t),this.each(function(){var n=e(this);n.parent().find("a.related-lookup").after(t.placeholder),n.next().addClass("grp-m2m"),n.addClass("grp-has-related-lookup"),r(n,t),n.bind("change focus keyup",function(){r(n,t)})})}};e.fn.grp_related_m2m=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_m2m"),!1):t.init.apply(this,arguments)};var r=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(r){values=e.map(r,function(e){return'<span class="grp-placeholder-label">'+e.label+"</span>"}),""===values?t.parent().find(".grp-placeholder-related-m2m").hide():t.parent().find(".grp-placeholder-related-m2m").show(),t.parent().find(".grp-placeholder-related-m2m").html(values.join('<span class="grp-separator"></span>'))})};e.fn.grp_related_m2m.defaults={placeholder:'<div class="grp-placeholder-related-m2m"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_related_generic.defaults,t),this.each(function(){var i=e(this),l=e(t.content_type).val()||e(t.content_type).find(":checked").val();l&&i.after(t.placeholder).after(r(i.attr("id"),l)),i.addClass("grp-has-related-lookup"),l&&a(i,t),i.bind("change focus keyup",function(){a(i,t)}),e(t.content_type).bind("change",function(){n(e(this),t)})})}};e.fn.grp_related_generic=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_related_generic"),!1):t.init.apply(this,arguments)};var r=function(t,r){var n=e('<a class="related-lookup"></a>');return n.attr("id","lookup_"+t),n.attr("href",window.ADMIN_URL+MODEL_URL_ARRAY[r].app+"/"+MODEL_URL_ARRAY[r].model+"/?"),n.attr("onClick","return showRelatedObjectLookupPopup(this);"),n},n=function(t,n){var a=e(n.object_id);a.val(""),a.parent().find("a.related-lookup").remove(),a.parent().find(".grp-placeholder-related-generic").remove();var i=e(t).val()||e(t).find(":checked").val();i&&a.after(n.placeholder).after(r(a.attr("id"),i))},a=function(t,r){var n=t.next().next();e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t),query_string:grappelli.get_query_string(t)},function(e){""===e[0].label?n.hide():n.show(),n.html('<span class="grp-placeholder-label">'+e[0].label+"</span>")})};e.fn.grp_related_generic.defaults={placeholder:'<div class="grp-placeholder-related-generic" style="display:none"></div>',repr_max_length:30,lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_fk.defaults,t),this.each(function(){var l=e(this);l.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),l.next().next()&&"errorlist"!=l.next().next().attr("class")&&"grp-help"!=l.next().next().attr("class")&&l.next().next().remove(),l.next().after(r).after(n(l.attr("id"))),l.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),l.parent().prepend("<input id='"+l.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=e.extend({wrapper_autocomplete:l.parent(),input_field:l.prev(),remove_link:l.next().next().hide(),loader:l.next().next().next().hide()},e.fn.grp_autocomplete_fk.defaults,t),i(l,t),a(l,t),l.bind("change focus keyup",function(){i(l,t)}),e("label[for='"+l.attr("id")+"']").each(function(){e(this).attr("for",l.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_fk=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_fk"),!1):t.init.apply(this,arguments)};var r=function(){var t=e('<div class="grp-loader">loader</div>');return t},n=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},a=function(t,r){r.wrapper_autocomplete.find("input:first").bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,source:function(n,a){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(n.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(e){r.loader.show()},success:function(t){a(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return!1},select:function(n,a){return r.input_field.val(a.item.label),t.val(a.item.value),t.trigger("change"),t.val()?e(r.remove_link).show():e(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append("<a>"+r.label+"</a>").appendTo(t):e("<li></li>").data("item.autocomplete",r).append("<span class='error'>"+r.label+"</span>").appendTo(t)}},i=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(n){e.each(n,function(a){r.input_field.val(n[a].label),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})})};e.fn.grp_autocomplete_fk.defaults={autocomplete_lookup_url:"",lookup_url:""}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_m2m.defaults,t),this.each(function(){var r=e(this);r.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),r.next().after(a).after(i(r.attr("id"))),r.parent().wrapInner("<div class='grp-autocomplete-wrapper-m2m'></div>"),r.parent().prepend("<ul class='grp-repr'><li class='grp-search'><input id='"+r.attr("id")+"-autocomplete' type='text' class='vTextField' value='' /></li></ul>"),t=e.extend({wrapper_autocomplete:r.parent(),wrapper_repr:r.parent().find("ul.grp-repr"),wrapper_search:r.parent().find("li.grp-search"),remove_link:r.next().next().hide(),loader:r.next().next().next().hide()},e.fn.grp_autocomplete_m2m.defaults,t),r.parent().find("ul.errorlist")&&r.parent().find("ul.errorlist").detach().appendTo(r.parent().parent()),p(r,t),o(r,t),r.bind("change focus keyup",function(){p(r,t)}),e("label[for='"+r.attr("id")+"']").each(function(){e(this).attr("for",r.attr("id")+"-autocomplete")}),t.wrapper_autocomplete.bind("click",function(r){e(r.target).hasClass("related-lookup")||e(r.target).hasClass("grp-related-remove")||t.wrapper_search.find("input:first").focus()})})}};e.fn.grp_autocomplete_m2m=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_m2m"),!1):t.init.apply(this,arguments)};var r=function(e,t,r){var n=[];return e.val()&&(n=e.val().split(",")),n.push(t),e.val(n.join(",")),e.trigger("change"),n.join(",")},n=function(e,t,r){var n=[];return e.val()&&(n=e.val().split(",")),n.splice(t,1),e.val(n.join(",")),e.trigger("change"),n.join(",")},a=function(){var t=e('<div class="grp-loader">loader</div>');return t},i=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},l=function(t,r,a){var i=e('<li class="grp-repr"></li>'),l=e('<a class="grp-m2m-remove" href="javascript://">'+r+"</a>");i.append(l),i.insertBefore(a.wrapper_search),l.bind("click",function(r){var i=e(this).parent().parent().children("li").index(e(this).parent());n(t,i,a),e(this).parent().remove(),t.val()?e(a.remove_link).show():e(a.remove_link).hide(),r.stopPropagation()}),l.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")})},o=function(t,n){n.wrapper_search.find("input:first").bind("keydown",function(t){t.keyCode===e.ui.keyCode.TAB&&e(this).data("uiAutocomplete").menu.active&&t.preventDefault()}).bind("focus",function(){n.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){n.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,position:{my:"left top",at:"left bottom",of:n.wrapper_autocomplete},open:function(t,r){e(".ui-menu").width(n.wrapper_autocomplete.outerWidth()-6)},source:function(r,a){e.ajax({url:n.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(r.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(e){n.loader.show()},success:function(t){a(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){n.loader.hide()}})},focus:function(){return!1},select:function(a,i){return l(t,i.item.label,n),r(t,i.item.value,n),t.val()?e(n.remove_link).show():e(n.remove_link).hide(),e(this).val("").focus(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append("<a>"+r.label+"</a>").appendTo(t):e("<li></li>").data("item.autocomplete",r).append("<span class='error'>"+r.label+"</span>").appendTo(t)}},p=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(n){r.wrapper_repr.find("li.grp-repr").remove(),r.wrapper_search.find("input").val(""),e.each(n,function(e){n[e].value&&l(t,n[e].label,r)}),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})}}(grp.jQuery),function(e){var t={init:function(t){return t=e.extend({},e.fn.grp_autocomplete_generic.defaults,t),this.each(function(){var p=e(this);p.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");var s=e(t.content_type).val()||e(t.content_type).find(":checked").val();s&&p.after(r).after(n(p.attr("id"))).after(a(p.attr("id"),s)),p.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),p.parent().prepend("<input id='"+p.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=e.extend({wrapper_autocomplete:e(this).parent(),input_field:e(this).prev(),remove_link:p.nextAll("a.grp-related-remove").hide(),loader:p.nextAll("div.grp-loader").hide()},e.fn.grp_autocomplete_generic.defaults,t),s&&o(p,t),l(p,t),p.bind("change focus keyup",function(){o(p,t)}),e(t.content_type).bind("change",function(){i(e(this),t)}),e("label[for='"+p.attr("id")+"']").each(function(){e(this).attr("for",p.attr("id")+"-autocomplete")})})}};e.fn.grp_autocomplete_generic=function(r){return t[r]?t[r].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof r&&r?(e.error("Method "+r+" does not exist on jQuery.grp_autocomplete_generic"),!1):t.init.apply(this,arguments)};var r=function(){var t=e('<div class="grp-loader">loader</div>');return t},n=function(t){var r=e('<a class="grp-related-remove"></a>');return r.attr("id","remove_"+t),r.attr("href","javascript://"),r.attr("onClick","return removeRelatedObject(this);"),r.hover(function(){e(this).parent().toggleClass("grp-autocomplete-preremove")}),r},a=function(t,r){var n=e('<a class="related-lookup"></a>');return n.attr("id","lookup_"+t),n.attr("href",window.ADMIN_URL+MODEL_URL_ARRAY[r].app+"/"+MODEL_URL_ARRAY[r].model+"/?"),n.attr("onClick","return showRelatedObjectLookupPopup(this);"),n},i=function(t,i){var l=e(i.object_id);l.val(""),l.prev().val(""),l.nextAll("a.related-lookup").remove(),l.nextAll("a.grp-related-remove").remove(),l.nextAll("div.grp-loader").remove();var o=e(t).val()||e(t).find(":checked").val();o&&(l.after(r).after(n(l.attr("id"))).after(a(l.attr("id"),o)),i.remove_link=l.nextAll("a.grp-related-remove").hide(),i.loader=l.nextAll("div.grp-loader").hide())},l=function(t,r){r.wrapper_autocomplete.find("input:first").bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,source:function(n,a){e.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(n.term)+"&app_label="+grappelli.get_app_label(t)+"&model_name="+grappelli.get_model_name(t)+"&query_string="+grappelli.get_query_string(t),beforeSend:function(t){var n=e(r.content_type).val()||e(r.content_type).find(":checked").val();return n?void r.loader.show():!1},success:function(t){a(e.map(t,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return!1},select:function(n,a){return r.input_field.val(a.item.label),t.val(a.item.value),t.trigger("change"),t.val()?e(r.remove_link).show():e(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(t,r){return r.value?e("<li></li>").data("item.autocomplete",r).append("<a>"+r.label+"</a>").appendTo(t):e("<li></li>").data("item.autocomplete",r).append("<span class='error'>"+r.label+"</span>").appendTo(t)}},o=function(t,r){e.getJSON(r.lookup_url,{object_id:t.val(),app_label:grappelli.get_app_label(t),model_name:grappelli.get_model_name(t)},function(n){e.each(n,function(a){r.input_field.val(n[a].label),t.val()?e(r.remove_link).show():e(r.remove_link).hide()})})};e.fn.grp_autocomplete_generic.defaults={autocomplete_lookup_url:"",lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(e){e.fn.grp_inline=function(t){var r={prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"grp-add-handler",removeCssClass:"grp-remove-handler",deleteCssClass:"grp-delete-handler",emptyCssClass:"grp-empty-form",formCssClass:"grp-dynamic-form",predeleteCssClass:"grp-predelete",onBeforeInit:function(e){},onBeforeAdded:function(e){},onBeforeRemoved:function(e){},onBeforeDeleted:function(e){},onAfterInit:function(e){},onAfterAdded:function(e){},onAfterRemoved:function(e){},onAfterDeleted:function(e){}};return t=e.extend(r,t),this.each(function(){var r=e(this),n=r.find("#id_"+t.prefix+"-TOTAL_FORMS");n.attr("autocomplete","off"),initInlineForms(r,t),initAddButtons(r,t),addButtonHandler(r.find("a."+t.addCssClass),t),removeButtonHandler(r.find("a."+t.removeCssClass),t),deleteButtonHandler(r.find("a."+t.deleteCssClass),t)})},getFormIndex=function(e,t,r){var n=e.find("[id^='id_"+t.prefix+"']").attr("id");return n?parseInt(r.exec(n)[1],10):-1},updateFormIndex=function(t,r,n,a){t.find(":input,span,table,iframe,label,a,ul,p,img,div").each(function(){var t=e(this),r=t.attr("id"),i=t.attr("name"),l=t.attr("for"),o=t.attr("href"),p=t.attr("class"),s=t.attr("onclick");r&&t.attr("id",r.replace(n,a)),i&&t.attr("name",i.replace(n,a)),l&&t.attr("for",l.replace(n,a)),o&&t.attr("href",o.replace(n,a)),p&&t.attr("class",p.replace(n,a)),s&&t.attr("onclick",s.replace(n,a))}),t.find(".prepopulated_field").each(function(){var t=e(this).data("dependency_ids")||[],r=[];e.each(t,function(e,t){r.push(t.replace(n,a))}),e(this).data("dependency_ids",r)})};var t=function(t,r){t.find(".prepopulated_field").each(function(){var t=e(this).data("dependency_ids")||[];e(this).prepopulate(t,e(this).attr("maxlength"))})};initInlineForms=function(t,r){t.find("div.grp-module").each(function(){var t=e(this);r.onBeforeInit(t),""!==t.attr("id")&&t.not("."+r.emptyCssClass).not(".grp-table").not(".grp-thead").not(".add-item").addClass(r.formCssClass),t.find("li.grp-delete-handler-container input").each(function(){e(this).is(":checked")&&t.hasClass("has_original")&&t.toggleClass(r.predeleteCssClass)}),r.onAfterInit(t)})},initAddButtons=function(e,t){var r=e.find("#id_"+t.prefix+"-TOTAL_FORMS"),n=e.find("#id_"+t.prefix+"-MAX_NUM_FORMS");e.find("a."+t.addCssClass);""!==n.val()&&n.val()-r.val()<=0&&hideAddButtons(e,t)},addButtonHandler=function(e,r){e.bind("click",function(){var n=e.parents(".grp-group"),a=n.find("#id_"+r.prefix+"-TOTAL_FORMS"),i=n.find("#id_"+r.prefix+"-MAX_NUM_FORMS"),l=(n.find("a."+r.addCssClass),n.find("#"+r.prefix+"-empty"));r.onBeforeAdded(n);var o=parseInt(a.val(),10),p=l.clone(!0);p.removeClass(r.emptyCssClass).attr("id",l.attr("id").replace("-empty",o));var s=/__prefix__/g;updateFormIndex(p,r,s,o),p.insertBefore(l).addClass(r.formCssClass);var c=p.find(".mceEditor").eq(0);c&&(tinyMCEOptions.selector="#"+c.attr("id"),tinyMCE.init(tinyMCEOptions)),a.val(o+1),0!==i.val()&&""!==i.val()&&i.val()-a.val()<=0&&hideAddButtons(n,r),t(p,r),r.onAfterAdded(p)})},removeButtonHandler=function(t,r){t.bind("click",function(){var n=t.parents(".grp-group"),a=e(this).parents("."+r.formCssClass).first(),i=n.find("#id_"+r.prefix+"-TOTAL_FORMS"),l=n.find("#id_"+r.prefix+"-MAX_NUM_FORMS"),o=/-(\d+)-/,p=getFormIndex(a,r,o);r.onBeforeRemoved(a),a.remove(),i.val(parseInt(i.val(),10)-1),0!==l.val()&&l.val()-i.val()>0&&showAddButtons(n,r),n.find("."+r.formCssClass).each(function(){var t=e(this),n=getFormIndex(t,r,o);n>p&&updateFormIndex(t,r,o,"-"+(n-1)+"-")}),r.onAfterRemoved(n)})},deleteButtonHandler=function(t,r){t.bind("click",function(){var t=e(this).prev(),n=e(this).parents("."+r.formCssClass).first();r.onBeforeDeleted(n),n.hasClass("has_original")&&(n.toggleClass(r.predeleteCssClass),t.prop("checked")?t.removeAttr("checked"):t.prop("checked",!0)),r.onAfterDeleted(n)})},hideAddButtons=function(e,t){var r=e.find("a."+t.addCssClass);r.hide().parents(".grp-add-item").hide(),r.closest(".grp-module.grp-transparent").hide()},showAddButtons=function(e,t){var r=e.find("a."+t.addCssClass);r.show().parents(".grp-add-item").show(),r.closest(".grp-module.grp-transparent").show()}}(grp.jQuery);